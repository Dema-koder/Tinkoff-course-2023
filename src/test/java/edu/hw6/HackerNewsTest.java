package edu.hw6;

import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;
import java.io.IOException;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

class HackerNewsTest {
    @Mock
    private HttpClient httpClientMock;

    @Mock
    private HttpResponse<String> httpResponseMock;

    public HackerNewsTest() {
        MockitoAnnotations.openMocks(this);
    }

    @Test
    public void testHackerNewsTopStories() throws IOException, InterruptedException {
        when(httpClientMock.send(any(HttpRequest.class), any(HttpResponse.BodyHandler.class)))
            .thenReturn(httpResponseMock);
        when(httpResponseMock.body()).thenReturn("[38396658,38390914,38378557,38392277,38396345,38394635,38392540,38391403,38391138,38393238,38394383,38395655,38378555,38394828,38393660,38379104,38377307,38391787,38393390,38393032,38394787,38394364,38378227,38387464,38393384,38395813,38381573,38394156,38394357,38390052,38394816,38396296,38375239,38392388,38394613,38375786,38396398,38391934,38393237,38392887,38376919,38389386,38392931,38375310,38393264,38392327,38392824,38395698,38390018,38384952,38387775,38394391,38376507,38378216,38395242,38392260,38392086,38383138,38395529,38389508,38393108,38391923,38364084,38388842,38386487,38380137,38387217,38392146,38363394,38388456,38387554,38382225,38378992,38394276,38386547,38383646,38364179,38371808,38375273,38354753,38393549,38388608,38372936,38394551,38383696,38389444,38393715,38393606,38383099,38361094,38383635,38394951,38393388,38382067,38385419,38394040,38387249,38344444,38387620,38388669,38372687,38356702,38393787,38377072,38370799,38368287,38353473,38364489,38365638,38387874,38394491,38352484,38371361,38388754,38378498,38391728,38394017,38361735,38360148,38379893,38378261,38366830,38380344,38377263,38356534,38354939,38391309,38379168,38346794,38390266,38362541,38373586,38361139,38395328,38379397,38376885,38351797,38380093,38395765,38380056,38360582,38389284,38362363,38376731,38368073,38388982,38342670,38372344,38390000,38335255,38377789,38379456,38372029,38358821,38392696,38346903,38389958,38379916,38379543,38343748,38376844,38381066,38370872,38347771,38360827,38360927,38368570,38373191,38376589,38380377,38375728,38364262,38343398,38359863,38394885,38369433,38361053,38378595,38362271,38354422,38353285,38362348,38366536,38366729,38361049,38341399,38354788,38386098,38357226,38392045,38357191,38388400,38387869,38367334,38362242,38370252,38376784,38360776,38382481,38344358,38362874,38378776,38382956,38343385,38392851,38394736,38349716,38366295,38380240,38357205,38361259,38338635,38361218,38368760,38363698,38362762,38365934,38370203,38380511,38385221,38361888,38368272,38387214,38391578,38378874,38357167,38362652,38363687,38374588,38357736,38374711,38386646,38386648,38377779,38363602,38371126,38381918,38368000,38344213,38343933,38386912,38371307,38364197,38358032,38372451,38360128,38344973,38383831,38383306,38391112,38386096,38343957,38360135,38369384,38342642,38386331,38388465,38364933,38338033,38384587,38378481,38361082,38370210,38390824,38351194,38387743,38393153,38351195,38378455,38394465,38361722,38346869,38377027,38368063,38373247,38360162,38393783,38391655,38353763,38386155,38364315,38392484,38363449,38388778,38373709,38366485,38345017,38387797,38354254,38382907,38373297,38353903,38357137,38374322,38361290,38382485,38385289,38368964,38368791,38351048,38363133,38355503,38385013,38382811,38381691,38391915,38367277,38361758,38378483,38363158,38382892,38381245,38374627,38343510,38365892,38345053,38388533,38352891,38351497,38356361,38353146,38337784,38392066,38370480,38344196,38356768,38383759,38359269,38367430,38384200,38385976,38367514,38385895,38372285,38343484,38341708,38365714,38372870,38371913,38365707,38361135,38387484,38367873,38385202,38375177,38343359,38351212,38371213,38368773,38360709,38384434,38336912,38354918,38386692,38388808,38350341,38385179,38340875,38345737,38345858,38354700,38377826,38381272,38371218,38360260,38351370,38372972,38347555,38370503,38361444,38340188,38380311,38366719,38362457,38336688,38353525,38347868,38388092,38389001,38387912,38365540,38372152,38350910,38345843,38369880,38389618,38387652,38334784,38339092,38349234,38381901,38353729,38361420,38337001,38342208,38384234,38359089,38384173,38377860,38370563,38346862,38370429,38370028,38368767,38360005,38366336,38365981,38386556,38347501,38356781,38361089,38388617,38374624,38373400,38366982,38377762,38366312,38340226,38366864,38371115,38376887,38365955,38374181,38353940,38375092,38391341,38369806,38339159,38341035,38353880,38361008,38376073,38339715,38362506,38383604,38356742,38378399,38369717,38382975,38371967,38389094,38356897,38360520,38356216,38363562,38360111,38389746,38352180,38369419,38367884,38334722,38369938,38354280,38379463,38382795,38366801,38348968,38378119,38368429,38382361,38361247,38359814,38338928,38371480,38376538,38355232,38364830,38377720,38348556,38370030,38366820,38337989,38369679,38341466,38369512,38358913,38375494,38360304,38390153,38376904,38352028,38375114,38334538,38348244,38388788,38359523,38379873,38367693,38344822,38346334,38389967,38350746,38357229,38370962,38340431,38376163,38374607,38373608,38345189,38370176]");

        HackerNews.client = httpClientMock;

        long[] topStories = HackerNews.hackerNewsTopStories();

        assertNotNull(topStories);
        assertEquals(500, topStories.length);
        assertEquals(38396658, topStories[0]);
    }

    @Test
    public void testNews() throws IOException, InterruptedException {
        // Mock the HttpClient and HttpResponse
        when(httpClientMock.send(any(HttpRequest.class), any(HttpResponse.BodyHandler.class)))
            .thenReturn(httpResponseMock);
        when(httpResponseMock.body()).thenReturn("{\"title\": \"JDK 21 Release Notes\"}");

        // Set the mocked HttpClient
        HackerNews.client = httpClientMock;

        // Call the method
        String newsTitle = HackerNews.news(37570037);

        // Verify the result
        assertNotNull(newsTitle);
        assertEquals("JDK 21 Release Notes", newsTitle);
    }
}
